{"version":3,"file":"pdftex.js","sources":["src/pdftex.js"],"sourcesContent":["/* eslint-env worker */\n\nclass PdfTeXCompilation {\n  constructor () {\n    this._ready = false\n    this.worker = new Worker(pdftex._dir + 'pdftex-worker.js')\n    this.ready = false\n    var self = this\n\n    this._eventListener = []\n\n    this.worker.addEventListener('message', function (event) {\n      var message = event.data\n      if (message.type === 'err' || message.type === 'log') {\n        self._fire(message.type, message.value)\n      } else if (message.type === 'finish') {\n        self._fire('finish', message.value)\n      } else if (message.type === 'ready') {\n        self._ready = true\n        self._fire('ready')\n      } else {\n        console.warn('Unexpected Worker response..', message)\n      }\n    })\n  }\n  _compile (source, options) {\n    var self = this\n    this.source = source\n    this._options = options || {}\n\n    if (options.debug) {\n      this.on('err', (err) => {\n        console.error(err)\n      })\n      this.on('log', (out) => {\n        console.log(out)\n      })\n    }\n    this.whenReady(function () {\n      self.worker.postMessage({ type: 'start', source: source })\n    })\n  }\n  // notifies event listeners\n  _fire (event, data) {\n    this._eventListener.forEach(l => {\n      if (l[0] === event) {\n        l[1](data)\n      }\n    })\n  }\n  // register an event listener\n  on (event, fn) {\n    this._eventListener.push([event, fn])\n  }\n  // stop the compilaten\n  terminate () {\n    this.worker.terminate()\n  }\n  whenReady (f) {\n    if (this._ready) {\n      f()\n    } else {\n      this.on('ready', f)\n    }\n  }\n}\n\nvar currentWorker = null\nvar nextWorker = null\n\nexport default function pdftex (source, options) {\n  if (currentWorker != null) {\n    currentWorker.terminate()\n  }\n  if (nextWorker == null) {\n    currentWorker = new PdfTeXCompilation()\n  } else {\n    currentWorker = nextWorker\n    nextWorker = null\n  }\n\n  currentWorker.on('finish', function () {\n    if (nextWorker == null) {\n      // preload when finishid\n      nextWorker = new PdfTeXCompilation()\n    }\n  })\n\n  currentWorker._compile(source, options)\n  return currentWorker\n}\n\npdftex.preload = function pdftexPreoad () {\n  if (nextWorker == null) {\n    nextWorker = new PdfTeXCompilation()\n  }\n}\n\npdftex._dir = './'\npdftex.setPdftexDir = function setPdftexDir (dir) {\n  if (typeof dir !== 'string') {\n    throw new Error('Expect path to be a String!')\n  }\n  if (dir[dir.length - 1] !== '/') {\n    dir += '/'\n  }\n  pdftex._dir = dir\n}\n"],"names":["pdftex","source","options","currentWorker","terminate","nextWorker","PdfTeXCompilation","on","_compile","_ready","worker","Worker","_dir","ready","self","this","_eventListener","addEventListener","event","message","data","type","_fire","value","warn","_options","debug","err","error","out","log","whenReady","postMessage","forEach","l","fn","push","f","preload","setPdftexDir","dir","Error","length"],"mappings":"iLAsEA,SAAwBA,GAAQC,EAAQC,SACjB,OAAjBC,KACYC,YAEE,MAAdC,IACc,GAAIC,MAEJD,IACH,QAGDE,GAAG,SAAU,WACP,MAAdF,MAEW,GAAIC,QAIPE,SAASP,EAAQC,GACxBC,0VAvFHG,yCAEGG,QAAS,OACTC,OAAS,GAAIC,QAAOX,EAAOY,KAAO,yBAClCC,OAAQ,KACTC,GAAOC,UAENC,uBAEAN,OAAOO,iBAAiB,UAAW,SAAUC,MAC5CC,GAAUD,EAAME,IACC,SAAjBD,EAAQE,MAAmC,QAAjBF,EAAQE,OAC/BC,MAAMH,EAAQE,KAAMF,EAAQI,OACP,WAAjBJ,EAAQE,OACZC,MAAM,SAAUH,EAAQI,OACH,UAAjBJ,EAAQE,QACZZ,QAAS,IACTa,MAAM,kBAEHE,KAAK,+BAAgCL,gDAIzClB,EAAQC,MACZY,GAAOC,UACNd,OAASA,OACTwB,SAAWvB,MAEZA,EAAQwB,aACLnB,GAAG,MAAO,SAACoB,WACNC,MAAMD,UAEXpB,GAAG,MAAO,SAACsB,WACNC,IAAID,WAGXE,UAAU,aACRrB,OAAOsB,aAAcX,KAAM,QAASpB,OAAQA,oCAI9CiB,EAAOE,QACPJ,eAAeiB,QAAQ,YACtBC,EAAE,KAAOhB,KACT,GAAGE,gCAKPF,EAAOiB,QACJnB,eAAeoB,MAAMlB,EAAOiB,6CAI5BzB,OAAON,8CAEHiC,GACLtB,KAAKN,gBAGFF,GAAG,QAAS8B,YAKnBlC,EAAgB,KAChBE,EAAa,WAwBjBL,GAAOsC,QAAU,WACG,MAAdjC,MACW,GAAIC,KAIrBN,EAAOY,KAAO,KACdZ,EAAOuC,aAAe,SAAuBC,MACxB,gBAARA,QACH,IAAIC,OAAM,8BAEU,OAAxBD,EAAIA,EAAIE,OAAS,QACZ,OAEF9B,KAAO4B"}