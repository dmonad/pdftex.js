{"version":3,"file":"pdftex.js","sources":["src/pdftex.js"],"sourcesContent":["\nclass PdfTeXCompilation {\n  constructor () {\n    this._ready = false\n    this.worker = new Worker('./src/pdftex-worker.js') // TODO: move to server\n    this.ready = false\n    var self = this\n\n    this._eventListener = []\n\n    this.worker.addEventListener('message', function (event) {\n      var message = event.data\n      if (message.type === 'err' || message.type === 'log') {\n        self._fire(message.type, message.value)\n      } else if (message.type === 'finish') {\n        self._fire('finish', message.value)\n      } else if (message.type === 'ready') {\n        self._ready = true\n        self._fire('ready')\n      } else {\n        console.warn('Unexpected Worker response..', message)\n      }\n    })\n  }\n  _compile (source, options) {\n    var self = this\n    this.source = source\n    this._options = options || {}\n\n    if (options.debug) {\n      this.on('err', (err) => {\n        console.error(err)\n      })\n      this.on('log', (out) => {\n        console.log(out)\n      })\n    }\n    this.whenReady(function () {\n      self.worker.postMessage({ type: 'start', source: source })\n    })\n  }\n  // notifies event listeners\n  _fire(event, data) {\n    this._eventListener.forEach(l => {\n      if (l[0] === event) {\n        l[1](data)\n      }\n    })\n  }\n  // register an event listener\n  on (event, fn) {\n    this._eventListener.push([event, fn])\n  }\n  // stop the compilaten\n  terminate () {\n    this.worker.terminate()\n  }\n  whenReady (f) {\n    if (this._ready) {\n      f()\n    } else {\n      this.on('ready', f)\n    }\n  }\n}\n\nvar currentWorker = null\nvar nextWorker = new PdfTeXCompilation()\n\nexport default function pdftex (source, options) {\n  if (currentWorker != null) {\n    currentWorker.terminate()\n  }\n  if (nextWorker != null) {\n    currentWorker = nextWorker\n  } else {\n    currentWorker = new PdfTeXCompilation()\n  }\n  currentWorker.on('finish', function () {\n    nextWorker = new PdfTeXCompilation()\n  })\n\n  currentWorker._compile(source, options)\n  return currentWorker\n}\n"],"names":["pdftex","source","options","currentWorker","terminate","nextWorker","PdfTeXCompilation","on","_compile","_ready","worker","Worker","ready","self","this","_eventListener","addEventListener","event","message","data","type","_fire","value","warn","_options","debug","err","error","out","log","whenReady","postMessage","forEach","l","fn","push","f"],"mappings":"iLAqEA,SAAwBA,GAAQC,EAAQC,SACjB,OAAjBC,KACYC,cAEE,MAAdC,EACcA,EAEA,GAAIC,KAERC,GAAG,SAAU,aACZ,GAAID,OAGLE,SAASP,EAAQC,GACxBC,0VAlFHG,yCAEGG,QAAS,OACTC,OAAS,GAAIC,QAAO,+BACpBC,OAAQ,KACTC,GAAOC,UAENC,uBAEAL,OAAOM,iBAAiB,UAAW,SAAUC,MAC5CC,GAAUD,EAAME,IACC,SAAjBD,EAAQE,MAAmC,QAAjBF,EAAQE,OAC/BC,MAAMH,EAAQE,KAAMF,EAAQI,OACP,WAAjBJ,EAAQE,OACZC,MAAM,SAAUH,EAAQI,OACH,UAAjBJ,EAAQE,QACZX,QAAS,IACTY,MAAM,kBAEHE,KAAK,+BAAgCL,gDAIzCjB,EAAQC,MACZW,GAAOC,UACNb,OAASA,OACTuB,SAAWtB,MAEZA,EAAQuB,aACLlB,GAAG,MAAO,SAACmB,WACNC,MAAMD,UAEXnB,GAAG,MAAO,SAACqB,WACNC,IAAID,WAGXE,UAAU,aACRpB,OAAOqB,aAAcX,KAAM,QAASnB,OAAQA,oCAI/CgB,EAAOE,QACNJ,eAAeiB,QAAQ,YACtBC,EAAE,KAAOhB,KACT,GAAGE,gCAKPF,EAAOiB,QACJnB,eAAeoB,MAAMlB,EAAOiB,6CAI5BxB,OAAON,8CAEHgC,GACLtB,KAAKL,gBAGFF,GAAG,QAAS6B,YAKnBjC,EAAgB,KAChBE,EAAa,GAAIC"}